import{t as P}from"../modules/shiki-CP1vAORI.js";import{d as T,r as L,G as _,E as R,D as O,h as c,T as V,b as $,o as K,w as r,g as i,B as l,e as C,m as A,v as j,x as G,C as w}from"../modules/vue-CKbSmOlE.js";import{m as M,C as z,r as U,q as W,t as q,v as Q,w as X,x as S}from"../index-4lNTijIA.js";import{u as E,f as Y}from"./context-DE9OclEI.js";import{_ as H}from"./CodeBlockWrapper.vue_vue_type_script_setup_true_lang-N2EAuuNq.js";import{I as J}from"./two-cols-header-DwNDmOE0.js";import"../modules/unplugin-icons-BW8i5lj_.js";const Z=T({props:{at:{type:[Number,String],default:"+1"},unmount:{type:Boolean,default:!1},transition:{type:[Object,String,Boolean],default:!1},tag:{type:String,default:"div"},childTag:{type:String,default:"div"}},setup({at:y,unmount:k,transition:d,tag:f,childTag:s},{slots:h}){const g=Object.entries(h).sort((t,e)=>-t[0].split("-")[0]+ +e[0].split("-")[0]),n=[];let m;for(const[t,e]of g){const u=L();if(Number.isFinite(+t))n.push([+t,m??+t+1,e,u]),m=+t;else{const[a,p]=t.split("-").map(Number);if(!Number.isFinite(a)||!Number.isFinite(p))throw new Error(`Invalid range for v-switch: ${t}`);n.push([a,p,e,u]),m=a}}const I=Math.max(...n.map(t=>t[1]))-1,v=M(),o=L(0),{$clicksContext:b,$nav:x}=E();_(()=>{const t=b.calculateSince(y,I);if(!t){o.value=z;return}b.register(v,t),R(()=>{o.value=t.currentOffset.value+1})}),O(()=>{b.unregister(v)});function B(){S.value=!0,P()}const D=d&&{...U(d,x.value.navDirection<0),tag:f,onAfterLeave:B};return()=>{const t=[];for(let e=n.length-1;e>=0;e--){const[u,a,p,N]=n[e],F=u<=o.value&&o.value<a;k&&!F||t.push(c(s,{key:e,ref:N,class:[W,o.value===u&&q,o.value>=a&&Q,!F&&X].filter(Boolean),"data-slidev-clicks-start":u,"data-slidev-clicks-end":a},p==null?void 0:p()))}return D?c(V,S.value?{}:D,()=>t):c(f,t)}}}),ri={__name:"cpp_lib_updates.md__slidev_13",setup(y){const{$clicksContext:k,$frontmatter:d}=E();return k.setup(),(f,s)=>{const h=H,g=Z;return K(),$(J,j(G(w(Y)(w(d),12))),{left:r(n=>[s[2]||(s[2]=i("h3",null,"inline API change (api.hpp)",-1)),s[3]||(s[3]=i("p",null,"before the change",-1)),C(h,A({},{ranges:[]}),{default:r(()=>s[0]||(s[0]=[i("pre",{class:"shiki shiki-themes dark-plus light-plus slidev-code",style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000","--shiki-dark-bg":"#1E1E1E","--shiki-light-bg":"#FFFFFF"}},[i("code",{class:"language-cpp"},[i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}},"// assume the function is too large for auto-inlining")]),l(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"inline"),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}}," int"),i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}}," bar"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"() { "),i("span",{style:{"--shiki-dark":"#C586C0","--shiki-light":"#AF00DB"}},"return"),i("span",{style:{"--shiki-dark":"#B5CEA8","--shiki-light":"#098658"}}," 10"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"; }")])])],-1)])),_:1},16),s[4]||(s[4]=l(" after the change ")),C(h,A({},{ranges:[]}),{default:r(()=>s[1]||(s[1]=[i("pre",{class:"shiki shiki-themes dark-plus light-plus slidev-code",style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000","--shiki-dark-bg":"#1E1E1E","--shiki-light-bg":"#FFFFFF"}},[i("code",{class:"language-cpp"},[i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#6A9955","--shiki-light":"#008000"}},"// assume the function is too large for auto-inlining")]),l(`
`),i("span",{class:"line"},[i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}},"inline"),i("span",{style:{"--shiki-dark":"#569CD6","--shiki-light":"#0000FF"}}," int"),i("span",{style:{"--shiki-dark":"#DCDCAA","--shiki-light":"#795E26"}}," bar"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"() { "),i("span",{style:{"--shiki-dark":"#C586C0","--shiki-light":"#AF00DB"}},"return"),i("span",{style:{"--shiki-dark":"#B5CEA8","--shiki-light":"#098658"}}," 20"),i("span",{style:{"--shiki-dark":"#D4D4D4","--shiki-light":"#000000"}},"; }")])])],-1)])),_:1},16)]),right:r(n=>[s[7]||(s[7]=i("h3",null,"Libraries Lib1 and Lib2 use api.hpp",-1)),s[8]||(s[8]=i("br",null,null,-1)),C(g,null,{0:r(()=>s[5]||(s[5]=[i("h4",null,"1. Lib1 was rebuilt with updated api.hpp",-1),i("h4",null,"2. Lib2 was built with old api.hpp",-1),i("h4",null,"3. Lib1 and Lib2 are built with default visibility",-1),i("br",null,null,-1),i("p",null,[i("strong",null,[i("span",{style:{color:"#ef4444"}},"Question: which bar Lib1 and Lib2 call?")])],-1)])),1:r(()=>s[6]||(s[6]=[i("h4",null,"1. We break One Definition Rule (ODR)",-1),i("h4",null,[l("2. Loader resolves "),i("code",null,"bar"),l(" address with "),i("code",null,"bar"),l(" from the first loaded binary (e.g. Lib1).")],-1),i("h4",null,[l("3. All the binaries use the first loaded "),i("code",null,"bar")],-1),i("p",null,[i("strong",null,[i("span",{style:{color:"#ef4444"}},"Lib2 gets an unexpected result.")])],-1)])),_:1})]),default:r(()=>[s[9]||(s[9]=i("h1",null,"3. Inline Code - The Problem",-1)),s[10]||(s[10]=i("h4",null,[l("1. "),i("code",null,"inline"),l(" keyword does not mean the code is always inlined")],-1)),s[11]||(s[11]=i("h4",null,"2. Assume in our case compiler did not inline the functions",-1)),s[12]||(s[12]=i("h4",null,"3. if a library is built with default symbols visibility (default on linux) - all the symbols are visible and participate in interposition",-1)),s[13]||(s[13]=i("br",null,null,-1))]),_:1},16)}}};export{ri as default};
